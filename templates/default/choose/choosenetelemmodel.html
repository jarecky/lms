<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!--// $Id$ //-->
<html>
    <head>
        <meta name="GENERATOR" content="LMS {$layout.lmsv}">
        <meta http-equiv="Content-Language" content="{$LANGDEFS.$_ui_language.html}">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>::: LMS :{if $layout.pagetitle != ""} {$layout.pagetitle} :{/if}::</title>
        <link href="img/style.css" rel="stylesheet" type="text/css">
        <script type="text/javascript" src="img/common.js"></script>
        <script type="text/javascript" src="img/autosuggest.js"></script>
    </head>
    <body class="light">
        {$xajax}
        <div id="overDiv" style="position:absolute; visibility:hidden; z-index:100;"></div>
        <script type="text/javascript" language="JavaScript" src="img/overlib.js"></script>
        {if !empty($producers)}
        <div id="autosuggest"><ul></ul></div>
        <form name="search" id="search" method="post" action="?m=choosenetdevmodel">
            <input type="submit" class="hiddenbtn">
            <table id="searchtable" cellpadding="5" width="100%">
                <tr class="dark">
                    <td class="fleftu nobr">
                        <img src="img/producer.gif" alt="">
                        <input type="text" name="search_producer" value="" size="40" onkeyup="document.search.submit();" {tip text="Enter producer name"}>
                    </td>
                </tr>
            </table>
        </form>
        <script type="text/javascript">
            new AutoSuggest(document.forms['search'], document.forms['search'].elements['search_producer'], '?m=choosenetdevmodel&ajax=1&what=', 1);
        </script>
        {/if}
        <table id="modeltable" width="100%" cellpadding="3">
            {if empty($producers)}
            <tr>
                <td width="100%" align="center">
                    <p>{trans("Network device models database is empty.")}</p>
                </td>
            </tr>
            {else}
            <tr class="light" id="producer">
                <td width="1%">{trans("Producer")}:</td>
                <td width="99%">
                    <select id="producer_sel" name="producerid" onchange="change_producer(this)" {tip text="Select producer"} style="width: 100%">
                        <option value="0">{trans('None')}</option>
                        {foreach from=$producers item=item}
                        <option value="{$item.id}"{if $item.id == $data.producerid} selected{/if}>{$item.name}</option>
                        {/foreach}
                    </select>
                </td>
            </tr>
            <tr class="light" id="model" {if empty($models)}style="display: none;"{/if}>
                <td>{trans("Model")}:</td>
                <td>
                    <select id="model_sel" name="modelid" {tip text="Select model"} style="width: 100%" onupdate="change_models(this);">
                        {foreach from=$models item=item}
                        <option value="{$item.id}"{if $item.id == $data.modelid} selected{/if}>{$item.name}</option>
                        {/foreach}
                    </select><br>
                    <input type="button" onclick="change_models(document.getElementById('model_sel'));" value="{trans('View port list')}">
                </td>
            </tr>
            <tr class="light">
                <td colspan="2" align="left" nowrap>
		    Numeracja ciągła: <input type="checkbox" value=1>
                    <ul id="model_ports" style="style-list: none">
                    </ul>
                </td>
            </tr>
            <tr class="light">
                <td colspan="2" align="right" nowrap>
                    <a href="javascript:submit_model()" accesskey="s">{trans("Submit")} <img src="img/save.gif" alt=""></a>
                </td>
            </tr>
            {/if}
        </table>
        <script type="text/javascript">
            <!--
    
            function change_producer(elem)
            {
                var model = document.getElementById('model');
                model.style.display = 'none';
                xajax_select_producer(elem.value);
            }
            
            function change_models(elem)
            {
		//alert(elem.value);
		xajax_select_model(elem.value);
            }

            function search_producer(id)
            {
                var producer = document.getElementById('producer_sel');
                producer.options[id].selected = true;
                change_producer(producer);
            }

            function update_models(data)
            {

                var i, len;
                var models_select = document.getElementById('model_sel');

                models_select.options.length = 0;
                for (i = 0, len = data.length; i < len; i++) {
                    models_select.options[models_select.options.length] = new Option(data[i].name, data[i].id);
                }
                if (len > 0) {
                    var models_row = document.getElementById('model');
                    models_row.style.display = '';
                }

                resize_frame();
            }
	    function clearNode(node){
	      node.innerHTML='';
	    return 0;

	    }

            function update_ports(data)
            {

                var i, len;
                var portlist = document.getElementById('model_ports');
		clearNode(portlist);
                for (i = 0, len = data.length; i < len; i++) {
		      var rli=document.createElement('tr');
		      //label, port_type, count, connector
		      rli.innerHTML=
		      '<li>'+
				    '<input type=text value='+data[i].label+
				    '> typ:<select><option value='+data[i].port_type+'>typ_portu</option></select>'+
				    ' {trans("connector")}:<select><option value='+data[i].connector+'>connector1</option></select>'+
				    ' {trans("count")}:<input type=text value='+data[i].portcount+' size=2>'+
				    '</li>';
/*		      '<td>label:'+data[i].label+' typ:'+data[i].port_type+' conn:'+data[i].connector+' ilosc:'+data[i].count+'</td>';*/
		      portlist.appendChild(rli);
                }

		var st = document.getElementById('model_ports');

                resize_frame();
            }

            function update_netdev(data){
		var port_types='<option value=0>port0</option>';//smarty rulez
		var connectors='<option value=0>conn0</option>';//smarty rulez
		var tr,slabel,tr,i,x,t=0,a;
		var dst=window.parent.document.getElementById('porttable');
		dst.innerHTML='';
		for(i=0; i<data.length; i++){
		    for(x=1; x<= data[i].portcount; x++){
			tr=window.parent.document.createElement('tr');
			slabel=data[i].label.replace("#",x+t);
			tr.innerHTML='<td>'+
			'{trans("Label:")}<input type=text name=label['+i+'_'+x+'] value="'+slabel+'">'+
			' {trans("Type:")}<select name=type['+i+'_'+x+']>'+
				    '<option value="'+data[i].port_type+'" selected>'+data[i].port_type+'</option>'+
				    port_types+
				    '</select>'+
			' {trans("Connector:")}'+
			'<select name=connector['+i+'_'+x+']><option value="'+data[i].connector+'" selected>'+data[i].connector+'</option>'+
				  connectors+
			'</select><IMG src="img/add.gif" alt="" title="{trans("Clone")}" onclick="clone(this);">&nbsp;'+
	'<IMG src="img/delete.gif" alt="" title="{trans("Delete")}" onclick="remports(this);"></td>';
//alert(tr.innerHTML);
			dst.appendChild(tr);
			a=x;
//alert('a:'+a+' t:'+t+' x:'+x+' continous:'+data[i].continous);
		    }
		    //t=a;
		    if(data[i].continous=='0')t=0; else t=a;
		}
            }
            function addportmap(dst, src)
	    {
//		clearNode(dst);
		var portlist = src;
		for(i=0; i<portlist.childNodes.length; i++) {
		  var row=portlist.childNodes[i].innerHTML;
		  drow=window.parent.document.createElement('tr');
		  drow.innerHTML=row;
		  dst.appendChild(drow);
		}  
	    }

            function submit_model()
            {
            //alert(document.getElementById('model_sel').value);
                var producer = document.getElementById('producer_sel');
                var model = document.getElementById('model_sel');
                var loc = window.parent.document.getElementById('location');

                if (producer.value !== '0') {
                    if (producer.value === '') {
                        alert('{trans("Producer is required!")}');
                        return;
                    }
                    if (model.value === '') {
                        alert('{trans("Model is required")}');
                        return;
                    }
			window.parent.document.getElementById('producer').value=producer.options[producer.selectedIndex].text;
			window.parent.document.getElementById('model').value=model.options[model.selectedIndex].text;
//			window.parent.getElementById('modelid').value=model.options[model.selectedIndex].value;
//			addportmap(window.parent.document.getElementById('porttable'),document.getElementById('model_ports'));
			xajax_update_parent(document.getElementById('model_sel').value);
			
			//                      netdevmodelform.elements[varname + '[producer]'].value = producer.options[producer.selectedIndex].text;
//                    netdevmodelform.elements[varname + '[model]'].value = model.options[model.selectedIndex].text;
//                    netdevmodelform.elements[varname + '[netdevicemodelid]'].value = model.value;
                } else {
//                    netdevmodelform.elements[varname + '[producer]'].value = '';
//                    netdevmodelform.elements[varname + '[model]'].value = '';
//                    netdevmodelform.elements[varname + '[netdevicemodelid]'].value = '';
                }


                window.parent.popclick();
            }

            function resize_frame()
            {
                var st = document.getElementById('searchtable');
                var lt = document.getElementById('modeltable');
                var h = (st ? st.offsetHeight : 0) + lt.offsetHeight;

                autoiframe_setsize('autoiframe', 550, Math.max(h, 160));
            }

            var win = window.parent;
            var varname = '{$data.varname}';
            var formname = '{$data.formname}';
            var netdevmodelform = win.document.forms[formname];

            resize_frame();
            //-->
        </script>
    </body>
</html>
