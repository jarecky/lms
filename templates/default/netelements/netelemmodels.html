{extends file="layout.html"}
{block name=title}::: LMS :{$layout.pagetitle|striphtml} :::{/block}
{block name=module_content}

{$xajax}
<!--// $Id$ //-->
<H1>{$layout.pagetitle}</H1>
<script>
function addports(){
  var port_types='<option value=0>{trans("Select")}</option>'	{foreach from=$NETPORTTYPES key=k item=val}
			      +'<option value="{$k}">{$val}</option>'
			    {/foreach}
;//smarty rulez
  var connectors='<option value=0>{trans("Select")}</option>'	{foreach from=$NETCONNECTORS key=k item=val}
			      +'<option value="{$k}">{$val}</option>'
			    {/foreach}
;//smarty rulez
  var node=document.getElementById('porttable');
  var row=document.createElement('tr');
  var index=document.getElementById('porttable').rows.length+1;
  row.innerHTML='<td class="nobr fleft fright" colspan="3">'+index+']{trans("Label:")}'+
	'<input type=text name="modeledit['+index+'][label]" value="xxx"> typ:<select name="modeledit['+index+'][netporttype]">'+
			    port_types+'</select>'+
	' {trans("connector")}:<select name="modeledit['+index+'][netconnector]">'+
	connectors+'</select>'+
	'<IMG src="img/add.gif" alt="" title="{trans("Clone")}" onclick="clone(this);">&nbsp;'+
	'<IMG src="img/delete.gif" alt="" title="{trans("Delete")}" onclick="remports(this);">'+
	'</td>';
  node.appendChild(row);
  renumerate('porttable');
}

function xaddport(id, label, connector, port_type, cn, pn){
  var port_types='<option value=0>{trans("Select")}</option>'	{foreach from=$NETPORTTYPES key=k item=val}
			      +'<option value="{$k}">{$val}</option>'
			    {/foreach}
;//smarty rulez
  var connectors='<option value=0>{trans("Select")}</option>'	{foreach from=$NETCONNECTORS key=k item=val}
			      +'<option value="{$k}">{$val}</option>'
			    {/foreach}
;//smarty rulez
  var node=document.getElementById('porttable');
  var row=document.createElement('tr');
  var index=document.getElementById('porttable').rows.length+1;
  row.innerHTML='<td class="nobr fleft fright" colspan="3">'+index+']{trans("Label:")}'+
	'<input type=text name="modeledit['+id+'][label]" value="'+label+'"> typ:<select name="modeledit['+id+'][netporttype]">'+
			    '<option value='+port_type+'>'+pn+'</option>'+
			    port_types+'</select>'+
	' {trans("connector")}:<select name="modeledit['+id+'][netconnector]">'+
	'<option value='+connector+'>'+cn+'</option>'+
	connectors+'</select>'+
	'<IMG src="img/add.gif" alt="" title="{trans("Clone")}" onclick="clone(this);">&nbsp;'+
	'<IMG src="img/delete.gif" alt="" title="{trans("Delete")}" onclick="remports(this);">'+
	'</td>';
  node.appendChild(row);
  renumerate('porttable');
}

function clone(src){
  var ports=document.getElementById('porttable');
  var nrow=document.createElement('tr');
  var nindex=ports.rows.length+1;
  nrow.innerHTML=src.parentNode.parentNode.innerHTML.replace(/[0-9]+\]/g,nindex+']');
  ports.insertBefore(nrow,src.parentNode.parentNode.nextSibling);
  renumerate('porttable');

}
function remports(row){
  row.parentNode.parentNode.parentNode.removeChild(row.parentNode.parentNode);
  
}  

function renumerate(id){
  var tab=document.getElementById(id);
    for(x=0; x<tab.rows.length; x++){
    tab.rows[x].innerHTML=tab.rows[x].innerHTML.replace(/\d+\]/g,(x+1)+']');
  }

}       
</script>

<div id="div_produceredit" style="display:none">
    <form name="produceredit" id="produceredit" method="POST">
    <input type="hidden" name="produceredit[id]" value="{$produceredit.id}" id="id_producer">
	<table width="100%" cellpadding="3">
		<tr class="dark">
			<td width="100%" class="fall bold" colspan="2">
				<span id="id_action_name">{trans("New producer")}</span>
			</td>
		</tr>
		<tr class="light">
			<td width="1%" class="fleft nobr">
				{trans("Producer name")}
			</td>
			<td width="99%" class="fright">
				{trans("Alternative name (optional)")}
			</td>
		</tr>
		<tr class="light">
			<td class="fleft nobr valign-top">
				<input type="text" name="produceredit[name]" style="width:250px" id="id_producername" value="{$produceredit.name}" {tip trigger="name" text="Enter producer name"}>
			</td>
			<td class="fright valign-top">
				<input type="text" name="produceredit[alternative_name]" style="width:550px" id="id_alternative_name" value="{$produceredit.alternative_name}">
			</td>
		</tr>
		<tr class="dark">
			<td width="100%" class="fall text-right" colspan="2">
				<a href="javascript:void(0);" onclick="xajax_save_producer(xajax.getFormValues('produceredit'));">{trans("Save")} <img src="img/add.gif" alt=""></a>
				<a href="javascript:void(0);" onclick="xajax_cancel_producer();">{trans("Cancel")} <img src="img/cancel.gif" alt=""></a>
			</td>
		</tr>
	</table>
    </form>
    <br>
</div>

<script type="text/javascript" language="JavaScript">
<!--
	function delproducer(id) {
		if (confirm('{trans("Producer removal will cause removal of all assigned models! Are you sure you want to continue?")}'))
			xajax_delete_producer(id);
	}
//-->
</script>

<form name="producer" id="producer" method="GET" action="?m=netelemmodels">
<input type="submit" class="hiddenbtn">
<input type="hidden" name="m" value="netelemmodels">
<input type="hidden" name="page" value="1">

	<table width="100%" cellpadding="3" class="table">
		<tr class="dark">
			<td width="100%" class="fall bold" colspan="2">
				{trans("Producers")}
			</td>
		</tr>
		<tr class="light">
			<td width="99%" class="fleft">
				<select name="p_id" style="min-width:250px;" onchange="document.producer.submit();" {tip text="Select producer" trigger="p_id"}>
					<option value="">- {trans("none")} -</option>
					{section name="producerlist" loop=$producerlist}
					<option value="{$producerlist[producerlist].id}"{if $listdata.pid == $producerlist[producerlist].id} selected{/if}>
						{$producerlist[producerlist].name}
					</option>
					{/section}
				</select>
				{if $producerinfo.alternative_name}<span title="[ Alternatywna nazwa producenta ]">{$producerinfo.alternative_name}</span>{/if}
			</td>
			<td width="1%" class="fright nobr text-right">
				{if $listdata.pid}
				<a href="javascript:void(0);" onclick="delproducer({$listdata.pid});"><img src="img/delete.gif" alt="[ {trans("Remove")} ]"></a>
				<a href="javascript:void(0);" onclick="xajax_edit_producer({$listdata.pid});"><img src="img/edit.gif" alt="[ {trans("Edit")} ]"></a>
				{/if}
			</td>
		</tr>
		<tr class="dark">
			<td colspan="2" class="fall text-right">
				<a href="javascript:void(0);" onclick="xajax_add_producer();">{trans("Add producer")} <img src="img/add.gif" alt=""></a>
			</td>
		</tr>
	</table>
</form>
<br>

<div id="div_modeledit" style="display:none;">
    <form name="modeledit" id="modeledit" method="POST">
    <input type="hidden" name="modeledit[id]" value="{$modeledit.id}" id="id_model">
    <input type="hidden" name="modeledit[pid]" value="{$listdata.pid}" id="id_pid">
	<table width="100%" cellpadding="3">
		<tr class="dark">
			<td width="100%" class="fall bold" colspan="3">
				<span id="id_model_action_name">{trans("New model")}</span>
			</td>
		</tr>
		<tr class="light">
			<td width="1%" class="fleft nobr">
				{trans("Model type")}
			</td>
			<td width="1%" class="nobr">
				{trans("Model name")}
			</td>
			<td width="99%" class="fright">
				{trans("Alternative name (optional)")}
			</td>
		</tr>
		<tr class="light">
			<td class="fleft nobr valign-top">
				<select NAME="modeledit[type]" {tip text="Select device type"} VALUE="{$modeledit.type}">
                                {foreach $_NETELEMENTTYPES as $idx => $type}
                                <OPTION VALUE="{$idx}"{if $modeledit.type == $idx} selected{/if}>{$type}</OPTION>
                                {/foreach}
                        </select>
			</td>
			<td class="nobr valign-top">
				<input type="text" name="modeledit[name]" style="width:250px" id="id_model_name" value="{$modeledit.name}" {tip text="Enter model name" trigger="name"}>
			</td>			<td class="fright valign-top">
				<input type="text" name="modeledit[alternative_name]" style="width:550px" id="id_model_alternative_name" value="{$modeledit.alternative_name}">
			</td>
		</tr>
		<tr class="light">
			  <td class="fleft fright" colspan=3>{trans('Ports')}:<IMG src="img/add.gif" alt="" {tip text="Add"} onclick="addports();"></td>
			</tr>
		    <tbody id="porttable" style="text-align:left;" class="lmsbox">
		    {section name=a loop=$ports}
		      <tr class="light">
			<td class="nobr fleft fright" colspan=3>
			    {trans('Label:')}<input type=text name="modeledit[{$ports[a]}][label]"> 
			    {trans('Type:')}<select name="modeedit[{$ports[a]}][netporttype]">
			    {foreach from=$NETPORTTYPES key=k item=val}
			      <option value="{$k}">{$val}</option>
			    {/foreach}
				  </select> 
			    {trans('Connector:')}<select name="nodeledit[{$ports[a]}][netconnector]">
			    {foreach from=$NETCONNECTORS key=k item=val}
			      <option value="{$k}">{$val}</option>
			    {/foreach}
				    </select></td>
			
		      </tr>
		      {/section}
		    </tbody>
		<tr class="dark">
			<td width="100%" class="fall text-right" colspan="3">
				<a href="javascript:void(0);" onclick="xajax_save_model(xajax.getFormValues('modeledit'));">{trans("Save")} <img src="img/save.gif" alt=""></a>
				<a href="javascript:void(0);" onclick="xajax_cancel_model();">{trans("Cancel")} <img src="img/cancel.gif" alt=""></a>
			</td>
		</tr>
	</table>
    </form>
    <br>
</div>


{if $modellist}
<table width="100%" cellpadding="3" class="table" cellspacing="3px">
	<tr class="dark">
		<td width="99%" class="fleftu bold" colspan="4">
			{trans("Model list")}
		</td>
		<td width="1%" class="frightu text-right nobr bold">
			{trans("Total:")} {$listdata.total}
		</td>
	</tr>
	{if $listdata.total != 0}
	<tr class="scroller">
		<td colspan="5" class="dark fall">
			{include file="scroller.html" loop=$modellist}
		</td>
	</tr>
	{/if}
	<tr class="dark">
		<td width="1%" class="fleft nobr bold" style="min-width:150px;">{trans("Type")}</td>
		<td width="1%" class="nobr bold" style="min-width:150px;">{trans("Name")}</td>
		<td width="97%" class="bold">{trans("Alternative name")}</td>
		<td width="1%" class="text-center nobr bold">{trans("Network devices")}</td>
		<td width="1%" class="fright text-right nobr">
			<a href="javascript:void(0);" onclick="xajax_add_model();">{trans("Add model")} <img src="img/add.gif"></a>
		</td>
	</tr>
	{cycle values="lucid,light" print=false}
	{section name=modellist loop=$modellist start=$start max=$pagelimit}
	{assign var="modelid" value=$modellist[modellist].id}
	<tr id="idtr{$modelid}" class="{cycle}" onmouseover="addClass(this, 'highlight')" onmouseout="removeClass(this, 'highlight')">
		<td width="1%" class="fleft nobr">{$_NETELEMENTTYPES[$modellist[modellist].type]}</td>
		<td width="1%" class="nobr">{$modellist[modellist].name}</td>
		<td width="97%">{$modellist[modellist].alternative_name}</td>
		<td width="1%" class="text-center nobr">{if $modellist[modellist].netdevcount}{$modellist[modellist].netdevcount}{/if}</td>
		<td width="1%" class="fright text-right nobr">
			<img src="img/delete.gif" onclick="xajax_delete_model({$modelid});">
			<img src="img/edit.gif" onclick="xajax_edit_model({$modelid});">
		</td>
	</tr>
	{/section}
	{if $listdata.total != 0}
	<tr class="scroller">
		<td colspan="5" class="dark fall">
			{include file="scroller.html" loop=$modellist}
		</td>
	</tr>
	{/if}
</table>
{/if}

{if !$modellist && $listdata.pid}
<table width="100%">
	<tr class="light">
		<td width="100%" class="fall text-center bold">
			<br>
			<p>
			{trans("There are no models matching to defined filter or model list is empty")}
			</p>
			<a href="javascript:void(0);" onclick="xajax_add_model();">{trans("Add new model")}</a>
			<br>
			<br>
		</td>
	</tr>
</table>
{/if}

{/block}
