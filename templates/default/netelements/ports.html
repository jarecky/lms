<!--// $Id$ //-->
<TABLE class="lmsbox">
    <THEAD>
	<TR>
		<TD style="width: 100%;" class="hand nobr" onClick="showOrHide('netports');">
			<IMG SRC="img/mac.gif" alt="">
			<span class="bold">{t a=$netports|@count}Ports ($a):{/t}</span>
		</TD>
	</TR>
    </THEAD>
    <TBODY>
	<TR id="netports" style="display:none;">
		<TD style="width: 100%;">
			<TABLE class="lmsbox-inner">
        <THEAD>
	<TR>
		<TD style="width: 10%;">
			<IMG src="img/netdev.gif" ALT=""> <span class="bold">{trans("Label")}:</span><BR>
			{trans("Type:")}
		</TD>
		<TD style="width: 40%;" class="nobr">
			{trans("Link technology:")}<BR>
			{trans("Link speed:")}
		</TD>
		<TD style="width: 40%;" class="nobr">
			{trans("Connectors:")}
		</TD>
		<TD style="width: 1%;" class="text-right nobr">
			{trans("Port")}:<BR>
			{trans("ID:")}
		</TD>
		<TD style="width: 1%;" class="nobr">
			<IMG src="img/netelem_takenports.gif" ALT=""> {trans("Dest. port")}:<BR>
			<IMG src="img/port.gif" ALT=""> {trans("Ports (used):")}
		</TD>
		<TD style="width: 1%;">
			&nbsp;
		</TD>
	</TR>
        </THEAD>
        <TBODY>
	{cycle values="light,lucid" print=false}
	{section name=netports loop=$netports start=$start}
	{$technology=$netports[netports].technology}
	{$speed=$_NETTECHNOLOGIES[$technology].speed}
	<TR class="highlight {cycle}">
		<TD class="valign-top nobr">
			<IMG src="img/netdev.gif" ALT=""> <span class="bold">{$netports[netports].label}</span><BR>
			{$_NETPORTTYPES[$netports[netports].type]}
		</TD>
		<TD class="valign-top nobr">
			{$_NETTECHNOLOGIES[$technology].name}<BR>
			{if $speed}{$_NETSPEEDS[$speed][0]}Mbps / {$_NETSPEEDS[$speed][1]}MBps{/if}
		</TD>
		<TD class="valign-top nobr">
			{if $netports[netports].connectortype}
				{assign var=connector value=","|explode:$netports[netports].connectortype}
			{else}
				{assign var=connector value=","|explode:$_NETTECHNOLOGIES[$technology].connector}
			{/if}	
			{section name=connector loop=$connector}
				{$_NETCONNECTORS[$connector[connector]]} 
			{/section}
				
		</TD>
		<TD class="valign-top nobr" id="elem_{$netelemlist[netelemlist].id}">
			{if $netelemlist[netelemlist].linktechnology}{$_LINKTECHNOLOGIES[$netelemlist[netelemlist].linktype][$netelemlist[netelemlist].linktechnology]}{/if}{if $netelemlist[netelemlist].linktype == 1 && ($netelemlist[netelemlist].srcradiosector || $netelemlist[netelemlist].dstradiosector)} ({if $netelemlist[netelemlist].srcradiosector}{$netelemlist[netelemlist].srcradiosector}{else}-{/if}/{if $netelemlist[netelemlist].dstradiosector}{$netelemlist[netelemlist].dstradiosector}{else}-{/if}){/if}<BR>
			{if $netelemlist[netelemlist].linkspeed}{$_LINKSPEEDS[$netelemlist[netelemlist].linkspeed]}{/if}
		</TD>
		<TD class="text-right nobr" onClick="return self.location.href='?m=netelement&action=info&id={$netelemlist[netelemlist].id}';">
			<IMG src="img/empty.gif" height="16">[{if $netelemlist[netelemlist].srcport}{$netelemlist[netelemlist].srcport}{/if}]<BR>
			({$netelemlist[netelemlist].id|string_format:"%04d"})
		</TD>
		<TD class="nobr">
			<span id="elemlinkproperties_{$netelemlist[netelemlist].id}" onClick="javascript:netlinkpropertieschoosewin('{$neteleminfo.id}', '{$netelemlist[netelemlist].id}', true);">
				<IMG SRC="img/{if $netelemlist[netelemlist].linktype == 1}wireless.gif{elseif $netelemlist[netelemlist].linktype == 2}netelem_takenports.gif{else}netelem_takenports.gif{/if}" alt="[ {trans("Change connection properties")} ]" title="[ {trans("Change connection properties")} ]" {tip trigger="elemlinkproperties_$netelemlist[netelemlist].id" text="<span style=\"white-space: nowrap;\">{trans("Link type:")} {$_LINKTYPES[$netelemlist[netelemlist].linktype]}<br>{if $netelemlist[netelemlist].linktype == 1}{if $netelemlist[netelemlist].srcradiosector}{trans("Radio sector:")} {$netelemlist[netelemlist].srcradiosector}<br>{/if}{if $netelemlist[netelemlist].dstradiosector}{trans("Destination radio sector:")} {$netelemlist[netelemlist].dstradiosector}<br>{/if}{/if}{if $netelemlist[netelemlist].linktechnology}{trans("Link technology:")} {$_LINKTECHNOLOGIES[$netelemlist[netelemlist].linktype][$netelemlist[netelemlist].linktechnology]}<br>{/if}{trans("Link speed:")} {$_LINKSPEEDS[$netelemlist[netelemlist].linkspeed]}</span>"}>
			</span>
			<span onClick="return self.location.href='?m=netelement&action=info&id={$netelemlist[netelemlist].id}';">
			[{if $netelemlist[netelemlist].dstport}{$netelemlist[netelemlist].dstport}{/if}]
			<BR><IMG SRC="img/port.gif" ALT=""> {$netelemlist[netelemlist].ports} ({$netelemlist[netelemlist].takenports})
			</span>
		</TD>
		<TD class="text-right">
			<A HREF="?m=netelemedit&action=disconnect&id={$neteleminfo.id}&elemid={$netelemlist[netelemlist].id}" OnClick="return confirmLink(this, '{trans("Are you sure, you want to delete that connection?")}');"><IMG SRC="img/delete.gif" {tip text="Delete connection"}></A>
		</TD>
	</TR>
	{sectionelse}
	<TR>
		<TD colspan="6" class="empty-table">
			<P>{trans("No such connected elements.")}</P>
		</TD>
	</TR>
	{/section}
	<TR>
		<TD class="ftop dark text-center nobr" COLSPAN="6">
			{if $neteleminfo.ports == $neteleminfo.takenports}
			<span class="bold">{trans("All ports in that element are in use.")}</span>
			{elseif !$restnetelemlist}
			<span class="bold">{trans("No such elements for connection.")}</span>
			{else}
			<FORM METHOD="GET" ACTION="?m=netelemedit" NAME="connect">
			<INPUT type="submit" class="hiddenbtn">
			<INPUT TYPE="HIDDEN" NAME="m" VALUE="netelemedit">
			<INPUT TYPE="HIDDEN" NAME="id" VALUE="{$neteleminfo.id}">
			<INPUT TYPE="HIDDEN" NAME="action" VALUE="connect">
			<TABLE style="width: 100%;">
				<TR>
					<TD style="width: 99%; white-space: nowrap;">
						<span class="bold">{trans("Connect")}:</span>
						{trans("Element:")}<SELECT NAME="netelem" id="srcnetelem" style="width: 300px" {tip trigger="link" text="Select from list element for connection"} onchange="get_radio_sectors_for_netelem(this.options[this.selectedIndex].value)">
						{section name=restnetelemlist loop=$restnetelemlist}
							{assign var=netelemname value=$restnetelemlist[restnetelemlist].name}
							{if $restnetelemlist[restnetelemlist].producer}{assign var=netelemname value=$netelemname|cat:" / "|cat:$restnetelemlist[restnetelemlist].producer}{/if}
							{if $restnetelemlist[restnetelemlist].location}{assign var=netelemname value=$netelemname|cat:" ("|cat:$restnetelemlist[restnetelemlist].location|cat:")"}{/if}
							<OPTION VALUE="{$restnetelemlist[restnetelemlist].id}"{if $connect.id == $restnetelemlist[restnetelemlist].id} selected{/if}>{$netelemname|truncate:120:"...":true}</OPTION>
						{/section}
						</SELECT>
						<label for="srcport">{trans("Port")}:</label><INPUT name="srcport" id="srcport" value="{if $connect.srcport}{$connect.srcport}{/if}" size="2" {tip text="Enter port number in element for connection (optional)" trigger="srcport"}>
						<SELECT NAME="srcradiosector" id="connboxsrcradiosector" {tip trigger="connboxsrcradiosector" text="Select radio sector"}{if $elemlinktype != 1} style="display: none;"{/if}>
							<OPTION value="0">- {trans("none")} -</OPTION>
						</SELECT>
						<label for="dstport">{trans("Dest. port")}:</label><INPUT name="dstport" id="dstport" value="{if $connect.dstport}{$connect.dstport}{/if}" size="2" {tip text="Enter port number in element to which element will be connected (optional)" trigger="dstport"}>
						<SELECT NAME="dstradiosector" id="connboxdstradiosector" {tip trigger="connboxdstradiosector" text="Select radio sector"}{if $elemlinktype != 1} style="display: none;"{/if}>
							<OPTION value="0">- {trans("none")} -</OPTION>
							{foreach $neteleminfo.radiosectors as $radiosector}
							<OPTION value="{$radiosector.id}"{if $radiosector.id == $netlinkdstradiosector} selected{/if}>{$radiosector.name}</OPTION>
							{/foreach}
						</SELECT>
						<SELECT name="linktype" id="connboxlinktype" {tip trigger="linktype" text="Select link type"} onchange="change_elemlinktype(this.options[this.selectedIndex].value)">
							{foreach from=$_LINKTYPES item=item key=key}
							<OPTION VALUE="{$key}"{if $key==$elemlinktype} selected{/if}>{$item}</OPTION>
							{/foreach}
						</SELECT>
						<SELECT NAME="linktechnology" id="connboxlinktechnology" {tip trigger="connboxlinktechnology" text="Select link technology"} onchange="change_elemlinktechnology(this.options[this.selectedIndex].value)">
							<OPTION value="0">{trans("- unknown -")}</OPTION>
							{if !$elemlinktype}{$elemlinktype = 0}{/if}
							{foreach $_LINKTECHNOLOGIES[$elemlinktype] as $linktechnologyidx => $linktechnology}
							<OPTION value="{$linktechnologyidx}"{if $linktechnologyidx == $elemlinktechnology} selected{/if}>{$linktechnology}</OPTION>
							{/foreach}
						</SELECT>
						<SELECT name="linkspeed" id="connboxlinkspeed" {tip trigger="linkspeed" text="Select link speed"}>
							{foreach from=$_LINKSPEEDS item=item key=key}
								<OPTION VALUE="{$key}"{if $key==$elemlinkspeed || (!$elemlinkspeed && $key==100000)} selected{/if}>{$item}</OPTION>
							{/foreach}
						</SELECT>
					</TD>
					<TD style="width: 1%; white-space: nowrap;">
						<A HREF="javascript:document.connect.submit(); ">{trans("Connect")}</A> <IMG src="img/save.gif" alt="">
					</TD>
				</TR>
			</TABLE>
			</FORM>
			{/if}
		</TD>
	</TR>
    </TBODY>
</TABLE>
               </TD>
       </TR>
    </TBODY>
</TABLE>
<SCRIPT type="text/javascript">
<!--
function change_elemlinktype(linktype) {
	linktype = parseInt(linktype);
	var options = xjx.$('connboxlinktechnology').options;
	while (options.length)
		options.remove(0);
	options.add(new Option('{trans("- unknown -")}', 0));
	switch (linktype) {
		case 0:
			{foreach $_LINKTECHNOLOGIES[0] as $linktechnologyidx => $linktechnology}
			options.add(new Option('{$linktechnology}', {$linktechnologyidx}));
			{/foreach}
			break;
		case 1:
			{foreach $_LINKTECHNOLOGIES[1] as $linktechnologyidx => $linktechnology}
			options.add(new Option('{$linktechnology}', {$linktechnologyidx}));
			{/foreach}
			break;
		case 2:
			{foreach $_LINKTECHNOLOGIES[2] as $linktechnologyidx => $linktechnology}
			options.add(new Option('{$linktechnology}', {$linktechnologyidx}));
			{/foreach}
			break;
	}
	xjx.$('connboxsrcradiosector').style.display = (linktype == 1 ? '' : 'none');
	xjx.$('connboxdstradiosector').style.display = (linktype == 1 ? '' : 'none');

	if (linktype == 1) {
		var selected = xjx.$('srcnetelem').selectedIndex;
		if (selected) {
			netelem = xjx.$('srcnetelem').options[selected].value;
			xajax_getRadioSectorsForNetelem('radio_sectors_received_for_srcnetelem', netelem);
		}
	}
}

function change_elemlinktechnology(linktechnology) {
	linktechnology = parseInt(linktechnology);
	var linktype = xjx.$('connboxlinktype').options[xjx.$('connboxlinktype').selectedIndex].value;
	if (linktype != 1)
		return;
	var netelem = xjx.$('srcnetelem').options[xjx.$('srcnetelem').selectedIndex].value;
	if (netelem !== undefined) {
		xjx.$('connboxsrcradiosector').disabled = true;
		xjx.$('connboxdstradiosector').disabled = true;
		xajax_getRadioSectorsForNetElem('radio_sectors_received_for_srcnetelem', netelem, linktechnology);
		xajax_getRadioSectorsForNetElem('radio_sectors_received_for_dstnetelem', {$neteleminfo.id}, linktechnology);
	}
}

function get_radio_sectors_for_netelem(netelem) {
	xjx.$('connboxsrcradiosector').disabled = true;
	xajax_getRadioSectorsForNetElem('radio_sectors_received_for_srcnetelem', netelem);
}

function radio_sectors_received_for_srcnetelem(radiosectors) {
	var options = xjx.$('connboxsrcradiosector').options;
	var oldvalue = options[xjx.$('connboxsrcradiosector').selectedIndex].value;
	while (options.length)
		options.remove(0);
	options.add(new Option('- {trans("none")} -', 0));
	if (radiosectors !== null) {
		radiosectors.forEach(function(elem) {
			var option = new Option(elem.name, elem.id);
			if (elem.id == oldvalue)
				option.selected = true;
			options.add(option);
		});
	}
	xjx.$('connboxsrcradiosector').disabled = false;
}

function radio_sectors_received_for_dstnetelem(radiosectors) {
	var options = xjx.$('connboxdstradiosector').options;
	var oldvalue = options[xjx.$('connboxdstradiosector').selectedIndex].value;
	while (options.length)
		options.remove(0);
	options.add(new Option('- {trans("none")} -', 0));
	if (radiosectors !== null) {
		radiosectors.forEach(function(elem) {
			var option = new Option(elem.name, elem.id);
			if (elem.id == oldvalue)
				option.selected = true;
			options.add(option);
		});
	}
	xjx.$('connboxdstradiosector').disabled = false;
}

xajax_getRadioSectorsForNetElem('radio_sectors_received_for_srcnetelem', {$restnetelemlist[0].id});

if (getCookie('netports') == '1')
	xjx.$('netports').style.display = '';
//-->
</SCRIPT>
