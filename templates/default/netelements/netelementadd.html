{extends file="layout.html"}
{block name=title}::: LMS :{$layout.pagetitle|striphtml} :::{/block}
{block name="module_content"}
{include file="calendar_js.html"}
{$xajax}
<script>
function change_producer(elem,type)
            {
                //var model = document.getElementById('model');
                //model.style.display = 'none';
                xajax_select_producer(elem.value, type.value);
            }
            
function update_models(data)
            {

                var i, len;
                var models_select = document.getElementById('model_sel');

                models_select.options.length = 0;
                for (i = 0, len = data.length; i < len; i++) {
                    models_select.options[models_select.options.length] = new Option(data[i].name, data[i].id);
                }
                if (len > 0) {
                    var models_row = document.getElementById('model');
                    models_row.style.display = '';
                }

                resize_frame();
            }
function change_models(elem)
            {
		//alert(elem.value);
		xajax_select_model(elem.value);
            }
function update_ports(data){
		var port_types='<option value=0>port0</option>';//smarty rulez
		var connectors='<option value=0>conn0</option>';//smarty rulez
		var tr,slabel,tr,i,x,t=0,a;
		var dst=document.getElementById('porttable');
		dst.innerHTML='';
		for(i=0; i<data.length; i++){
		    for(x=1; x<= data[i].portcount; x++){
			tr=document.createElement('tr');
			slabel=data[i].label.replace("#",x+t);
			tr.innerHTML='<td>'+index+']{trans("Label:")}'+
	'<input type=text name="netelem['+index+'][label]" value=""> typ:<select name="netelem['+index+'][typ]"><option selected>typ_portu</option>'+port_types+'</select>'+
	' {trans("connector")}:<select name="netelem['+index+'][connector]"><option selected>connector1</option>'+connectors+'</select>'+
	'<IMG src="img/add.gif" alt="" title="{trans("Clone")}" onclick="clone(this);">&nbsp;'+
	'<IMG src="img/delete.gif" alt="" title="{trans("Delete")}" onclick="remports(this);">'+
	'</td>';
			dst.appendChild(tr);
			a=x;
		    }
		    //t=a;
		    if(data[i].continous=='0')t=0; else t=a;
		}
            }
function addports(){
  var port_types='<option value=0>port0</option>';//smarty rulez
  var connectors='<option value=0>conn0</option>';//smarty rulez
  var node=document.getElementById('porttable');
  var row=document.createElement('tr');
  var index=document.getElementById('porttable').childNodes.length+1;
  row.innerHTML='<td>'+index+']{trans("Label:")}'+
	'<input type=text name="netelem['+index+'][label]" value=""> typ:<select name="netelem['+index+'][typ]"><option selected>typ_portu</option>'+port_types+'</select>'+
	' {trans("connector")}:<select name="netelem['+index+'][connector]"><option selected>connector1</option>'+connectors+'</select>'+
	'<IMG src="img/add.gif" alt="" title="{trans("Clone")}" onclick="clone(this);">&nbsp;'+
	'<IMG src="img/delete.gif" alt="" title="{trans("Delete")}" onclick="remports(this);">'+
	'</td>';
  node.appendChild(row);
}

function clone(src){
  var ports=document.getElementById('porttable');
  var nrow=document.createElement('tr');
  var nindex=ports.childNodes.length+1;
  nrow.innerHTML=src.parentNode.parentNode.innerHTML.replace(/[0-9]+\]/g,nindex+']');
  ports.insertBefore(nrow,src.parentNode.parentNode.nextSibling);
  for(x=0; x<ports.childNodes.length; x++){
    ports.childNodes[x].innerHTML=ports.childNodes[x].innerHTML.replace(/\d+\]/g,x+']');
  }
  ports.insertBefore(nrow,src.parentNode.parentNode.nextSibling);

}
function remports(row){
  row.parentNode.parentNode.parentNode.removeChild(row.parentNode.parentNode);
}       
       
</script>
<H1>{$layout.pagetitle}</H1>
TODO: uzaleznic zawartosc od typu, asygnacja zmiennych + defaulty
<FORM NAME="netelemadd" METHOD="POST" ACTION="?m={$smarty.get.m}">
<INPUT type="submit" class="hiddenbtn">
<table class="lmsbox"> <!-- tabela glowna -->
  <thead>
  <tr>
    <td>
      <IMG SRC="img/netelem.gif" ALT="">
      <B>{trans("Name:")}</B>
      <INPUT TYPE="TEXT" NAME="netelem[name]" VALUE="{$netelem.name|default: '*AUTO*'}" MAXLENGTH="32" {tip trigger="name" text="Enter device name" bold=1}>
      <input type=hidden id="modelid" name="netelem[modelid]" value="{$netelem.modelid}">
    <td>
  </tr>
  </thead>
  <tbody>
  <tr>
    <td width="50%" class="container"><!-- pierwsza kolumna -->
	<table> 
                <tr>
                  <td><IMG SRC="img/producer.gif" ALT="">
                  </td>
                  <td><B>{trans("Type:")}</B>
                  </td>
                  <td><select NAME="netelem[type]" {tip text="Select device type"} VALUE="{$netelem.type}" id="type">
                                {foreach $_NETELEMENTTYPES as $idx => $type}
                                <OPTION VALUE="{$idx}"{if $netelem.type == $idx} selected{/if}>{$type}</OPTION>
                                {/foreach}
                        </select>
                  </td>
                </tr>		
		<tr>
		  <td><IMG SRC="img/producer.gif" ALT="">
		  </td>
		  <td><B>{trans("Manufacturer:")}</B>
		  </td>
		  <td><select id="producer_sel" name="producerid" onchange="change_producer(this, getElementById('type'))" {tip text="Select producer"} style="width: 80%">
                        <option value="0">{trans('None')}</option>
                        {foreach from=$producers item=item}
                        <option value="{$item.id}"{if $item.id == $data.producerid} selected{/if}>{$item.name}</option>
                        {/foreach}
                    </select>
		  </td>
		</tr>
		
		<tr>
		  <td><IMG SRC="img/netelem_model.gif" ALT="">
		  </td>
		  <td><B>{trans("Model:")}</B>
		  </td>
		  <td><select id="model_sel" name="modelid" {tip text="Select model"} style="width: 80%" onchange="change_models(this);">
                        {foreach from=$models item=item}
                        <option value="{$item.id}"{if $item.id == $data.modelid} selected{/if}>{$item.name}</option>
                        {/foreach}
                    </select>
		  </td>
		</tr>
		
		<TR>
		<TD WIDTH="1%"><IMG SRC="img/serialnumber.gif" ALT="">
		</TD>
		<TD WIDTH="1%" NOWRAP><B>{trans("Serial number:")}</B>
		</TD>
		<TD WIDTH="98%"><INPUT TYPE="TEXT" NAME="netelem[serialnumber]" VALUE="{$netelem.serialnumber}" {tip text="Enter device serial number (optional)"}>
		</TD>
	</TR>
{if ConfigHelper::checkConfig('phpui.radius')}
	<TR>
		<TD WIDTH="1%"><IMG SRC="img/radius.gif" ALT="">
		</TD>
		<TD WIDTH="1%" NOWRAP><B>{trans("Shortname:")}</B>
		</TD>
		<TD WIDTH="98%"><INPUT TYPE="TEXT" NAME="netelem[shortname]" VALUE="{$netelem.shortname}" MAXLENGTH="32" {tip trigger="shortname" text="Enter shortname (optional)"}>
		</TD>
	</TR>
	<TR>
		<TD WIDTH="1%"><IMG SRC="img/radius.gif" ALT="">
		</TD>
		<TD WIDTH="1%" NOWRAP><B>{trans("Type:")}</B>
		</TD>
		<TD WIDTH="98%"><SELECT NAME="netelem[nastype]" {tip text="Select type (optional)" trigger="nastype"}>
				<OPTION VALUE="0"></OPTION>
				{foreach from=$nastype item=item key=key}
				<OPTION VALUE="{$key}" {if $key==$netelemices.nastype} SELECTED{/if}>{$item.name}</OPTION>
				{/foreach}
			</SELECT>
		</TD>
	</TR>
	<TR>
		<TD WIDTH="1%"><IMG SRC="img/radius.gif" ALT="">
		</TD>
		<TD WIDTH="1%" NOWRAP><B>{trans("Max clients:")}</B>
		</TD>
		<TD WIDTH="98%"><INPUT TYPE="TEXT" NAME="netelem[clients]" VALUE="{if $netelem.clients}{$netelem.clients}{/if}" {tip trigger="clients" text="Enter max clients (optional)"}>
		</TD>
	</TR>
	<TR>
		<TD WIDTH="1%"><IMG SRC="img/radius.gif" ALT="">
		</TD>
		<TD WIDTH="1%" NOWRAP><B>{trans("Secret:")}</B>
		</TD>
		<TD WIDTH="98%"><INPUT TYPE="TEXT" NAME="netelem[secret]" VALUE="{$netelem.secret}" MAXLENGTH="60" {tip text="Enter secret (optional)"}>
		</TD>
	</TR>
	<TR>
		<TD WIDTH="1%"><IMG SRC="img/radius.gif" ALT="">
		</TD>
		<TD WIDTH="1%" NOWRAP><B>{trans("Community:")}</B>
		</TD>
		<TD WIDTH="98%"><INPUT TYPE="TEXT" NAME="netelem[community]" VALUE="{$netelem.community}" MAXLENGTH="50" {tip text="Enter community (optional)"}>
		</TD>
	</TR>
{/if}
{if isset($channels)}
	<TR>
		<TD WIDTH="1%"><IMG SRC="img/channel.gif" ALT="">
		</TD>
		<TD WIDTH="1%" NOWRAP><B>{trans("Channel:")}</B>
		</TD>
		<TD WIDTH="98%"><SELECT NAME="netelem[channelid]" {tip text="Select channel (optional)" trigger="channelid"}>
				<OPTION VALUE="">- {trans("none")} -</OPTION>
				{foreach from=$channels item=item}
				<OPTION VALUE="{$item.id}" {if $item.id == $netelem.channelid} SELECTED{/if}>{$item.name}</OPTION>
				{/foreach}
			</SELECT>
		</TD>
	</TR>
{/if}
		
	</table>
    </td><!-- EOF pierwsza kolumna -->
    <td width="50%" class="container"><!-- druga kolumna -->
	<table> 
      <!-- zawartosc 2 kolumny -->
		<tr>
		  <td><IMG SRC="img/producer.gif" ALT="">
		  </td>
		  <td><B>{trans("Status:")}</B>
		  </td>
		  <td><select NAME="netelem[status]" {tip text="Select device status"} VALUE="{$netelem.status}">
				{foreach $_NETELEMENTSTATUSES as $idx => $status}
				<OPTION VALUE="{$idx}"{if $netelem.status == $idx} selected{/if}>{$status}</OPTION>
				{/foreach}
			</select>
		  </td>
		</tr>
	<TR>
		<TD WIDTH="1%">
			<IMG SRC="img/calendar.gif" ALT="">
		</TD>
		<TD WIDTH="1%" NOWRAP>
			<B>{trans("Purchase date:")}</B>
		</TD>
		<TD WIDTH="98%">
			<div class="calendar">
			<INPUT TYPE="TEXT" NAME="netelem[purchasedate]" VALUE="{if $netelem.purchasedate}{$netelem.purchasedate}{/if}" SIZE="10" MAXSIZE="10" {tip trigger="purchasedate" text="Enter device purchase date in 'yyyy/mm/dd' format or click to choose date from calendar (optional)"}>
			</div>
		</TD>
	</TR>
	<TR>
		<TD WIDTH="1%">
			<IMG SRC="img/guarantee.png" ALT="">
		</TD>
		<TD WIDTH="1%" NOWRAP>
			<B>{trans("Guarantee period:")}</B>
		</TD>
		<TD WIDTH="98%">
			<SELECT SIZE="1" NAME="netelem[guaranteeperiod]" {tip text="Select device guarantee period (optional)"}>
				{foreach from=$_GUARANTEEPERIODS key=key item=period}
				<OPTION VALUE="{$key}"{if $netelem.guaranteeperiod == $key} SELECTED{/if}>{$period}</OPTION>
				{/foreach}
			</SELECT>
		</TD>
	</TR>
	<TR>
		<TD WIDTH="1%">
			<IMG SRC="img/desc.gif" ALT="">
		</TD>
		<TD WIDTH="1%" NOWRAP>
			<B>{trans("Description:")}</B>
		</TD>
		<TD WIDTH="98%">
			<TEXTAREA NAME="netelem[description]" COLS="40" ROWS="5" {tip text="Enter additional information (optional)"}>{$netelem.description}</TEXTAREA>
		</TD>
	</TR>
	<TR>
		<TD width="1%">
			<img src="img/money.gif" alt="">
		</TD>
		<TD WIDTH="1%" class="bold nobr">
			{trans("Investment project:")}
		</TD>
		<TD WIDTH="98%">
			<SELECT NAME="netelem[invprojectid]" ID="NNproject" VALUE="{$neteleminfo.invprojectid}" {tip text="Select project for this node"} onchange="setNNProject();">
				<OPTION value="-2" {if ($neteleminfo.invprojectid == '-2' ) } selected="selected" {/if} >- {trans("none")} -</OPTION>
				<OPTION value="-1" {if ($neteleminfo.invprojectid == '-1' ) } selected="selected" {/if}>{trans("New project")}</OPTION>
				<OPTION value="1" {if ($neteleminfo.invprojectid == '1' ) } selected="selected" {/if}>{trans("From root device")}</OPTION>
				{section name=project loop=$NNprojects}
				<OPTION VALUE="{$NNprojects[project].id}" {if ($neteleminfo.invprojectid == $NNprojects[project].id ) } selected="selected" {/if} >{$NNprojects[project].name}</OPTION>
				{/section}
			</SELECT>
			<INPUT TYPE="TEXT" NAME="netelem[projectname]" VALUE="{$neteleminfo.projectname}" {tip text="Enter new project name" trigger="projectname" } ID="NNprojectname">
		</TD>
	</TR>
	<TR>
		<TD width="1%">
			<img src="img/netelem.gif" alt="">
		</TD>
		<TD WIDTH="1%" class="bold nobr">
			{trans("Net node:")}
		</TD>
		<TD WIDTH="98%">
			<SELECT NAME="netelem[netnodeid]" VALUE="{$neteleminfo.netnodeid}" {tip text="Select netnode"} >
				<OPTION VALUE="-1">{trans("Create netnode")}</OPTION>
				{section name=nd loop=$NNnodes}
				<OPTION VALUE="{$NNnodes[nd].id}" {if ($neteleminfo.netnodeid == $NNnodes[nd].id ) } selected="selected" {/if} >{$NNnodes[nd].name}</OPTION>
				{/section}
			</SELECT>
		</TD>
	</TR>
		
	
	</table>
    </td><!-- EOF druga kolumna -->
  </tr>
  <tr>
    <td colspan=2>{trans('Ports')}:<IMG src="img/add.gif" alt="" {tip text="Add"} onclick="addports();">
    </td>
  </tr><!-- EOF porty -->
  <tr><!-- Porty -->
    <td colspan=2 width="100%" class="container">
      <table width="100%"><!-- do porttable JS wrzuca porty -->
	    <tbody id="porttable" style="text-align:left;"></tbody>
      </table>
    </td>
  </tr><!-- EOF porty -->
  <tr>
      
      <TD WIDTH="100%" ALIGN="RIGHT" colspan=2>
			<A HREF="javascript:document.netelemadd.submit();" ACCESSKEY="s">{trans("Submit")} <IMG SRC="img/save.gif" alt=""></A>
			<A HREF="?m=netelemlist">{trans("Cancel")} <IMG SRC="img/cancel.gif" alt=""></A><br>
                       <INPUT type="checkbox" name="nodedata[reuse]" id="reuse" value="ON" {if $nodedata.reuse}checked{/if}> <label for="reuse">{trans("Display this fo
rm again, when this node is saved")}</label>
       </TD>
  </tr>
</tbody>
</table><!-- EOF glowna -->
</form>
{/block}
